if (self.CavalryLogger) { CavalryLogger.start_js(["e9XDE"]); }

__d("ServiceWorkerExperimentPerfTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("logger:ServiceWorkerExperimentPerfLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("logger:ServiceWorkerExperimentPerfLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:ServiceWorkerExperimentPerfLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAppCache=function(a){this.$1.app_cache=a;return this};a.prototype.setBodyVisible=function(a){this.$1.body_visible=a;return this};a.prototype.setClientRev=function(a){this.$1.client_rev=a;return this};a.prototype.setCsstart=function(a){this.$1.csstart=a;return this};a.prototype.setDisplayDone=function(a){this.$1.display_done=a;return this};a.prototype.setDns=function(a){this.$1.dns=a;return this};a.prototype.setDomComplete=function(a){this.$1.dom_complete=a;return this};a.prototype.setDomContentLoad=function(a){this.$1.dom_content_load=a;return this};a.prototype.setDomInteractiveLoad=function(a){this.$1.dom_interactive_load=a;return this};a.prototype.setDomSetup=function(a){this.$1.dom_setup=a;return this};a.prototype.setE2e=function(a){this.$1.e2e=a;return this};a.prototype.setEfRsrcSuccessRate=function(a){this.$1.ef_rsrc_success_rate=a;return this};a.prototype.setExperimentType=function(a){this.$1.experiment_type=a;return this};a.prototype.setFetchStartMs=function(a){this.$1.fetch_start_ms=a;return this};a.prototype.setFirstResponse=function(a){this.$1.first_response=a;return this};a.prototype.setHardwareConcurrency=function(a){this.$1.hardware_concurrency=a;return this};a.prototype.setHasSwCacheStorage=function(a){this.$1.has_sw_cache_storage=a;return this};a.prototype.setHomePageRouteLoadCount=function(a){this.$1.home_page_route_load_count=a;return this};a.prototype.setIsRecentLogin=function(a){this.$1.is_recent_login=a;return this};a.prototype.setIsSecondLoad=function(a){this.$1.is_second_load=a;return this};a.prototype.setIsSpinOverride=function(a){this.$1.is_spin_override=a;return this};a.prototype.setIsSwFnrLoad=function(a){this.$1.is_sw_fnr_load=a;return this};a.prototype.setLastResponse=function(a){this.$1.last_response=a;return this};a.prototype.setLoadedViaSwCache=function(a){this.$1.loaded_via_sw_cache=a;return this};a.prototype.setNavStartMs=function(a){this.$1.nav_start_ms=a;return this};a.prototype.setPackageCohort=function(a){this.$1.package_cohort=a;return this};a.prototype.setPageClient=function(a){this.$1.page_client=a;return this};a.prototype.setPath=function(a){this.$1.path=a;return this};a.prototype.setRbbDisplayDone=function(a){this.$1.rbb_display_done=a;return this};a.prototype.setRedirect=function(a){this.$1.redirect=a;return this};a.prototype.setRequest=function(a){this.$1.request=a;return this};a.prototype.setRespond=function(a){this.$1.respond=a;return this};a.prototype.setServerRev=function(a){this.$1.server_rev=a;return this};a.prototype.setServerRoute=function(a){this.$1.server_route=a;return this};a.prototype.setSubstream0=function(a){this.$1.substream_0=a;return this};a.prototype.setSubstream1=function(a){this.$1.substream_1=a;return this};a.prototype.setSwCacheAge=function(a){this.$1.sw_cache_age=a;return this};a.prototype.setSwControlledWindow=function(a){this.$1.sw_controlled_window=a;return this};a.prototype.setSwPageLoadCount=function(a){this.$1.sw_page_load_count=a;return this};a.prototype.setSwStarted=function(a){this.$1.sw_started=a;return this};a.prototype.setTcp=function(a){this.$1.tcp=a;return this};a.prototype.setTti=function(a){this.$1.tti=a;return this};a.prototype.setUnload=function(a){this.$1.unload=a;return this};a.prototype.setVC=function(a){this.$1.vc=a;return this};c={app_cache:!0,body_visible:!0,client_rev:!0,csstart:!0,display_done:!0,dns:!0,dom_complete:!0,dom_content_load:!0,dom_interactive_load:!0,dom_setup:!0,e2e:!0,ef_rsrc_success_rate:!0,experiment_type:!0,fetch_start_ms:!0,first_response:!0,hardware_concurrency:!0,has_sw_cache_storage:!0,home_page_route_load_count:!0,is_recent_login:!0,is_second_load:!0,is_spin_override:!0,is_sw_fnr_load:!0,last_response:!0,loaded_via_sw_cache:!0,nav_start_ms:!0,package_cohort:!0,page_client:!0,path:!0,rbb_display_done:!0,redirect:!0,request:!0,respond:!0,server_rev:!0,server_route:!0,substream_0:!0,substream_1:!0,sw_cache_age:!0,sw_controlled_window:!0,sw_page_load_count:!0,sw_started:!0,tcp:!0,tti:!0,unload:!0,vc:!0};e.exports=a}),null);
__d("ServiceWorkerProfilerTypes",["TimingAnnotations"],(function(a,b,c,d,e,f){a={START:"start",PARSED:"parsed",INITIALIZED:"init",FIRST_EVENT:"firstEvent",ACTIVATE_START:"activate_start",RESOURCE_CACHE_ACTIVATE_START:"resource_cache_activate_start",RESOURCE_CACHE_ACTIVATE_END:"resource_cache_activate_end",ACTIVATE_END:"activate_end"};b={FETCH_START:"start",ROUTE_CONFIG_CACHE_LOOKUP_START:"routeLookupStart",ROUTE_CONFIG_CACHE_LOOKUP_END:"routeLookupEnd",BEGIN_RESPONSE:"beginResponse",CACHE_FLUSH:"cacheFlush",RESOURCE_CACHE_FETCH_START:"resourceCacheFetchStart",RESOURCE_CACHE_FETCH_END:"resourceCacheFetchEnd",NETWORK_REQUEST_START:"requestStart",NETWORK_REQUEST_END:"requestEnd",NETWORK_RESPONSE_START:"responseStart",NETWORK_RESPONSE_END:"responseEnd",FETCH_END:"end"};e.exports={WorkerTiming:a,FetchTiming:b}}),null);
__d("ServiceWorkerURLCleaner",[],(function(a,b,c,d,e,f){__p&&__p();var g=/sw_fnr_id=\d+&?/,h=/fnr_t=\d+&?/,i=!1,j=!1;a={removeRedirectID:function(){__p&&__p();if(i)return j;i=!0;if(location.search&&g.test(location.search)){j=!0;if(history!==undefined&&typeof history.replaceState==="function"){var a=location.toString().replace(g,"").replace(h,"").replace(/\?$/,"");history.replaceState({},document.title,a)}}return j}};e.exports=a}),null);
__d("ServiceWorkerWindowPerfLogger",["regeneratorRuntime","Promise","Arbiter","ArtillerySWDataCollector","BanzaiODS","BanzaiScuba","BigPipe","NavigationMetrics","PageletEventConstsJS","ServiceWorkerExperimentPerfTypedLogger","ServiceWorkerProfilerTypes","ServiceWorkerRegistration","ServiceWorkerURLCleaner","SiteData","SubscriptionsHandler","UserAgentData","pageLoadedViaSWCache","performance"],(function(a,b,c,d,e,f){__p&&__p();var g="reactbluebar_perf",h="sw_ef_cache_hits",i="navigationStart",j="fetchStart",k="domainLookupStart",l="connectStart",m="connectEnd",n="responseStart",o="responseEnd",p="domLoading",q="domInteractive",r="domContentLoadedEventEnd",s="domComplete",t="unloadEventStart",u="unloadEventEnd",v=b("ServiceWorkerProfilerTypes").WorkerTiming,w=b("ServiceWorkerProfilerTypes").FetchTiming,x=(c={},c[b("PageletEventConstsJS").ARRIVE_START]={},c[b("PageletEventConstsJS").DISPLAY_END]={},c),y=function(c){__p&&__p();var d,e,f,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;return b("regeneratorRuntime").async(function(P){__p&&__p();while(1)switch(P.prev=P.next){case 0:d=new(b("BanzaiScuba"))(g,null,{addBrowserFields:!0,addGeoFields:!0,addPredictedGeographyFields:!0,addRequestFields:!0});e=new(b("ServiceWorkerExperimentPerfTypedLogger"))();e.setExperimentType(c.experimentName);e.setIsSecondLoad(c.isSecondLoad);e.setIsSpinOverride(c.isSpinOverride);e.setLoadedViaSwCache(b("pageLoadedViaSWCache")());e.setPageClient(c.page);e.setClientRev(b("SiteData").client_revision);e.setServerRev(b("SiteData").server_revision);e.setPackageCohort(b("SiteData").pkg_cohort);e.setIsRecentLogin(c.isRecentLogin);d.addNormal("path",a.location.href);e.setPath(a.location.href);f=b("ServiceWorkerURLCleaner").removeRedirectID();e.setIsSwFnrLoad(f);d.addInteger("sw_fnr_load",f?1:0);d.addNormal("experiment_type",c.experimentName);d.addNormal("page_client",c.page);d.addNormal("response_type",b("pageLoadedViaSWCache")()?"sw":"server");d.addNormal("second_load",c.isSecondLoad);d.addNormal("spin_override",c.isSpinOverride);d.addNormal("client_revision",b("SiteData").client_revision);d.addNormal("server_revision",b("SiteData").server_revision);d.addNormal("package_cohort",b("SiteData").pkg_cohort);d.addNormal("recent_login",c.isRecentLogin?"true":"false");c.serverRoute&&(d.addNormal("serverRoute",c.serverRoute),e.setServerRoute(c.serverRoute));y=navigator.serviceWorker&&navigator.serviceWorker.controller;e.setSwControlledWindow(Boolean(y));d.addNormal("sw_controlled_window",y?1:0);navigator.hardwareConcurrency&&(d.addInteger("hardwareConcurrency",navigator.hardwareConcurrency),e.setHardwareConcurrency(navigator.hardwareConcurrency));if(!b("performance").timing){P.next=56;break}z=b("performance").timing,A=z.navigationStart,B=z.fetchStart;e.setFetchStartMs(B);e.setNavStartMs(A);d.addInteger("tti",c.tti-B);d.addInteger("e2e",c.e2e-B);d.addInteger("display_done",c.displayDone-B);c.bodyVisible&&d.addInteger("body_visible",c.bodyVisible-B);typeof a._cstart==="number"&&d.addInteger("cstart",a._cstart-B);P.next=41;return b("regeneratorRuntime").awrap(b("Promise").all([b("ArtillerySWDataCollector").collect(),y?b("ServiceWorkerRegistration").getWorkerRegistration():b("Promise").resolve(null)]));case 41:C=P.sent,D=C[0],E=C[1],D&&((F=D.workerPerf,G=F.workerTimings,H=F.fetchTimings),I={await_route_config_cache:[w.ROUTE_CONFIG_CACHE_LOOKUP_START,w.ROUTE_CONFIG_CACHE_LOOKUP_END],flush_cache_content:[w.BEGIN_RESPONSE,w.CACHE_FLUSH],await_server_response:[w.CACHE_FLUSH,w.NETWORK_RESPONSE_START],flush_server_content:[w.NETWORK_RESPONSE_START,w.NETWORK_RESPONSE_END]},Object.keys(I).forEach(function(a){var b=I[a],c=H[b[0]];b=H[b[1]];if(!c||!b)return;d.addInteger(a+".begin",c.ts-A);d.addInteger(a+".end",b.ts-A);d.addInteger(a+".total",b.ts-c.ts)}),J=G[v.START],J&&J.ts>=A?(d.addInteger("sw_started",1),e.setSwStarted(!0)):J&&(d.addInteger("sw_started",0),e.setSwStarted(!1)),D.workerPerf.annotations.stringProps.hasSWCache&&(D.workerPerf.annotations.stringProps.hasSWCache==="true"?(e.setHasSwCacheStorage(!0),d.addInteger("has_sw_cache_storage",1)):(e.setHasSwCacheStorage(!1),d.addInteger("has_sw_cache_storage",0))),D.workerPerf.annotations.stringProps.efRSRCSuccess!==undefined&&(K=Number(D.workerPerf.annotations.stringProps.efRSRCSuccess),e.setEfRsrcSuccessRate(K),d.addInteger("ef_rsrc_success_rate",Math.round(K*100))),D.workerPerf.annotations.stringProps.controlledWindows!==undefined&&d.addInteger("sw_controlled_windows",Number(D.workerPerf.annotations.stringProps.controlledWindows)),D.workerPerf.annotations.stringProps.swLoadCountRouteHome!==undefined&&(L=Number(D.workerPerf.annotations.stringProps.swLoadCountRouteHome),d.addInteger("home_page_route_load_count",L),e.setHomePageRouteLoadCount(L)),D.workerPerf.annotations.stringProps.swAgeRouteHome!==undefined&&(M=Number(D.workerPerf.annotations.stringProps.swAgeRouteHome),d.addInteger("home_page_route_age",M),e.setSwCacheAge(M)),D.workerPerf.annotations.stringProps.swFetchRouteHome!==undefined&&d.addNormal("home_page_route_status",D.workerPerf.annotations.stringProps.swFetchRouteHome),D.fullCacheHitData&&(N=new(b("BanzaiScuba"))(h,null,{addBrowserFields:!0,addGeoFields:!0,addPredictedGeographyFields:!0,addRequestFields:!0}),N.addInteger("sw_fnr_load",f?1:0),N.addNormal("experiment_type",c.experimentName),N.addNormal("page_client",c.page),N.addNormal("response_type",b("pageLoadedViaSWCache")()?"sw":"server"),N.addNormal("second_load",c.isSecondLoad),N.addNormal("spin_override",c.isSpinOverride),N.addNormal("client_revision",b("SiteData").client_revision),c.serverRoute&&N.addNormal("serverRoute",c.serverRoute),N.addInteger("display_done_navs",c.displayDone-A),N.addInteger("tti_navs",c.tti-A),D.workerPerf.annotations.stringProps.hasSWCache&&D.workerPerf.annotations.stringProps.hasSWCache==="true"?N.addInteger("has_sw_cache_canary",1):N.addInteger("has_sw_cache_canary",0),K!==undefined&&N.addInteger("ef_rsrc_success_rate",Math.round(K*100)),N.addNormal("full_cache_hit_data",D.fullCacheHitData),N.post())),E&&(d.addNormal("active_worker",E.active?1:0),d.addNormal("waiting_worker",E.waiting?1:0),d.addNormal("installing_worker",E.installing?1:0)),d.addInteger("tti_navs",c.tti-A),e.setTti(c.tti-A),d.addInteger("e2e_navs",c.e2e-A),e.setE2e(c.e2e-A),d.addInteger("display_done_navs",c.displayDone-A),e.setDisplayDone(c.displayDone-A),c.bodyVisible&&(O=c.bodyVisible,d.addInteger("body_visible_navs",O-A),e.setBodyVisible(O-A)),typeof a._cstart==="number"&&(d.addInteger("cstart_navs",a._cstart-A),e.setCsstart(a._cstart-A)),Object.keys(x).forEach(function(a){var c=x[a];Object.keys(c).forEach(function(f){d.addInteger("pagelet_"+a+"_"+f+"_navs",c[f]-A);if(a===b("PageletEventConstsJS").ARRIVE_START&&(f==="first_response"||f==="last_response"||f==="substream_0"||f==="substream_1")){var g={};g[f]=c[f]-A;e.updateData(g)}})}),[{name:"redirect",start:i,end:j},{name:"app_cache",start:j,end:k},{name:"dns",start:k,end:l},{name:"tcp",start:l,end:m},{name:"request",start:m,end:n},{name:"respond",start:n,end:o},{name:"dom_setup",start:n,end:p},{name:"dom_interactive_load",start:p,end:q},{name:"dom_content_load",start:q,end:r},{name:"dom_complete",start:r,end:s},{name:"unload",start:t,end:u}].forEach(function(a){__p&&__p();var c=a.name,f=a.start;a=a.end;f=b("performance").timing[f]||0;a=b("performance").timing[a]||0;if(a>=f){d.addInteger("perf_timing_"+c,a-f);var g={};g[c]=a-f;e.updateData(g)}});case 56:d.post(),e.log();case 58:case"end":return P.stop()}},null,this)};d={init:function(a){__p&&__p();var c=a.isSecondLoad,d=a.experimentName,e=a.serverRoute,f=a.isSpinOverride,g=a.isRecentLogin;b("BanzaiODS").bumpEntityKey("web_speed","ServiceWorkerPerfInit");b("BanzaiODS").bumpEntityKey("web_speed","ServiceWorkerPerfInit."+b("UserAgentData").browserName);var h=null,i=new(b("SubscriptionsHandler"))();i.addSubscriptions(b("Arbiter").subscribe("sw/bodyVisible",function(a,c){a=c.relativeTime;b("performance").timing&&(h=a+b("performance").timing.navigationStart)}));i.addSubscriptions(b("Arbiter").subscribe(b("BigPipe").Events.init,function(a,b){__p&&__p();a=b.arbiter;b=a.subscribe("pagelet_event",function(a,b){__p&&__p();var event=b.event;a=b.id;b=b.ts;if(!x[event]||typeof b!=="number")return;var c=["first_response","last_response","pagelet_welcome_box","pagelet_dock","pagelet_navigation","pagelet_composer","substream_0","substream_1","pagelet_ego_pane",{regex:/^topnews_main_stream_(\d+)$/,name:"topnews_main_stream"},{regex:/^hyperfeed_story_id_(\d+)$/,name:"hyperfeed_story"}],d=null;for(var e=0;e<c.length;e++){var f=c[e];if(typeof f==="string"){if(f===a){d=f;break}}else if(f.regex.test(a)){d=f.name;break}}d&&!x[event][d]&&(x[event][d]=b)});i.addSubscriptions(b)}));i.addSubscriptions(b("NavigationMetrics").addRetroactiveListener(b("NavigationMetrics").Events.NAVIGATION_DONE,function(a,b){a=b.page;var j=b.pageType,k=b.tti,l=b.e2e;b=b.all_pagelets_displayed;j=j||"normal";if(j!=="normal")return;i.release();y({bodyVisible:h,displayDone:b,e2e:l,page:a,pageType:j,tti:k,isSecondLoad:c,isSpinOverride:f,experimentName:d,serverRoute:e,isRecentLogin:g})}))}};e.exports=d}),null);