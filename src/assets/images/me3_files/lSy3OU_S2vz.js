if (self.CavalryLogger) { CavalryLogger.start_js(["oc7Ms"]); }

__d("AlbumMediaUploadUtils",["VideoUploadConfig"],(function(a,b,c,d,e,f){__p&&__p();a={isVideoFile:function(a){a=a.name;var c=b("VideoUploadConfig").videoExtensions;a=a.indexOf(".")!==-1?a.split(".").pop().toLowerCase():"";return c[a]},hasVideos:function(a){return this._filterVideos(a).length>0},_filterVideos:function(a){return this._filterFileOfSupportedType(a,b("VideoUploadConfig").videoExtensions)},_filterFileOfSupportedType:function(a,b){return a.filter(function(a){a=a.indexOf(".")!==-1?a.split(".").pop().toLowerCase():"";return b[a]})}};e.exports=a}),null);
__d("UploadSession",["invariant","AlbumMediaUploadUtils","AsyncRequest","FilePickerEvent","PhotosUploadWaterfall","PUWSteps","SubscriptionsHandler","URI"],(function(a,b,c,d,e,f,g){__p&&__p();var h={};function i(a){"use strict";this._sessionID=a,this._asyncBootstrapped=!1,this._controller=null,this._overlay=null,this._pickers=[],this._pendingPhotoFileLists=[],this._pendingVideoFileLists=[],this._beginLogged=!1,this._albumLimitWasExceeded=!1,this._sessionLimitWasExceeded=!1,this._subscriptions=new(b("SubscriptionsHandler"))()}i.prototype.addFilePicker=function(a){"use strict";__p&&__p();this._pickers.includes(a)||(this._pickers.push(a),this._controller&&a.getSwfID&&a.getSwfID()&&(this._controller.preregisterSwf&&this._controller.preregisterSwf(a.getSwfID())),this._subscriptions.addSubscriptions(a.subscribe(b("FilePickerEvent").BEGIN,function(c,d){this._beginLogged||(this._beginLogged=!0,a.logWaterfallStep(b("PhotosUploadWaterfall").BEGIN),a.logStep(b("PUWSteps").CLIENT_FLOW_BEGIN))}.bind(this)),a.subscribe(b("FilePickerEvent").SELECTED,function(c,d){__p&&__p();a.logStep(b("PUWSteps").CLIENT_SELECT_SUCCESS,{volume:d.files.length});var e=[],f=[];d.files.forEach(function(a){b("AlbumMediaUploadUtils").isVideoFile(a)?e.push(a):f.push(a)});this._controller?(f.length>0&&this._controller.uploadFiles(f),this._videoController&&e.length>0&&this._videoController.uploadFiles(e)):(f.length>0&&this._pendingPhotoFileLists.push(f),e.length>0&&this._pendingVideoFileLists.push(e));if(this._asyncBootstrapped)return;c=a._button;var g=new(b("URI"))(c.getAttribute("ajaxify"));g.addQueryData("num_selected",d.files.length);b("AsyncRequest").bootstrap(g.toString(),c,!0);this._asyncBootstrapped=!0}.bind(this)),a.subscribe(b("FilePickerEvent").SELECT_START,function(){a.logStep(b("PUWSteps").CLIENT_SELECT_BEGIN)}.bind(this)),a.subscribe(b("FilePickerEvent").SELECT_CANCELED,function(){a.logStep(b("PUWSteps").CLIENT_SELECT_CANCEL),this._overlay||(a.logStep(b("PUWSteps").CLIENT_FLOW_CANCEL),this._beginLogged=!1)}.bind(this)),a.subscribe(b("FilePickerEvent").ALBUM_LIMIT_EXCEEDED,function(){this._controller?this._controller.albumLimitExceeded():this._albumLimitWasExceeded=!0}.bind(this)),a.subscribe(b("FilePickerEvent").SESSION_LIMIT_EXCEEDED,function(){this._controller?this._controller.sessionLimitExceeded():this._sessionLimitWasExceeded=!0}.bind(this))))};i.prototype.addController=function(a,c){"use strict";__p&&__p();this._controller=a;this._videoController=c;this._asyncBootstrapped=!0;a=this._controller.getWaterfallID?this._controller.getWaterfallID():this._controller.getWaterfallConfig().waterfallID;c=this._controller.getUploaderApp?this._controller.getUploaderApp():this._controller.getWaterfallConfig().waterfallApp;this._beginLogged||(this._beginLogged=!0,b("PhotosUploadWaterfall").sendSignal({qn:a,step:b("PhotosUploadWaterfall").BEGIN,uploader:c}));if(this._pendingPhotoFileLists.length>0||this._pendingVideoFileLists.length>0){var d=[],e=[];this._pendingVideoFileLists.forEach(function(a){e=e.concat(a)});this._pendingPhotoFileLists.forEach(function(a){d=d.concat(a)});d.length>0&&this._controller.uploadFiles(d);e.length>0&&this._videoController.uploadFiles(e)}else b("PhotosUploadWaterfall").sendSignal({qn:a,step:b("PhotosUploadWaterfall").OVERLAY_FIRST,uploader:c});this._albumLimitWasExceeded&&this._controller.albumLimitExceeded();this._sessionLimitWasExceeded&&this._controller.sessionLimitExceeded()};i.prototype.addOverlay=function(a){"use strict";this._overlay=a};i.prototype.addOverlayAndController=function(a,b){"use strict";this.addOverlay(a),this.addController(b,null)};i.prototype.getFilePickers=function(){"use strict";return this._pickers};i.prototype.cleanup=function(){"use strict";this._subscriptions&&this._subscriptions.release()};i.addFilePickerToSession=function(a,b){"use strict";j(a).addFilePicker(b)};i.addControllerToSession=function(a,b,c){"use strict";j(a).addController(b,c)};i.addOverlayToSession=function(a,b){"use strict";j(a).addOverlay(b)};i.addOverlayAndControllerToSession=function(a,b,c){"use strict";j(a).addOverlayAndController(b,c)};i.restartSessionPersistingFilePickers=function(a){"use strict";var b=j(a),c=new i(a);b.getFilePickers().forEach(function(a){c.addFilePicker(a)});k(a,c)};function j(a){h[a]||(h[a]=new i(a));return h[a]}function k(a,b){h[a]||g(0),h[a].cleanup(),delete h[a],h[a]=b}e.exports=i}),null);